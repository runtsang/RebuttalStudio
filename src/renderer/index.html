<!doctype html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rebuttal Studio</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div class="app">
    <!-- ── Project Switcher Pull-tab (visible when inside a project) ── -->
    <div id="projectDrawer" class="project-drawer hidden">
      <button id="drawerToggle" class="drawer-toggle" aria-label="Toggle project list">
        <span class="drawer-toggle-icon">◂</span>
      </button>
      <div class="drawer-panel">
        <h2 class="sidebar-title">Projects</h2>
        <div id="drawerProjectList" class="project-nav"></div>
      </div>
    </div>

    <aside id="sidebar" class="sidebar">
      <!-- Default mode: project list -->
      <div id="sidebarProjects" class="sidebar-projects-mode">
        <div>
          <h2 class="sidebar-title">Projects</h2>
          <div id="projectList" class="project-nav"></div>
        </div>
        <button id="settingsBtn" class="settings-btn" aria-label="Open settings">⚙</button>
      </div>

      <!-- Stage breakdown mode (shown when inside a project) -->
      <div id="sidebarStages" class="sidebar-stages-mode hidden">
        <div class="stages-header">
          <h2 class="sidebar-title">Stages</h2>
        </div>
        <div id="sidebarStageList" class="sidebar-stage-list"></div>
        <div class="sidebar-bottom-row">
          <button id="nextStageBtn" class="btn next-stage-btn">Next Stage →</button>
          <button id="settingsBtnStage" class="settings-btn" aria-label="Open settings">⚙</button>
        </div>
      </div>
    </aside>

    <main class="main">
      <header class="topbar">
        <div class="topbar-left">
          <button id="brandBtn" class="brand-btn" aria-label="Go to projects home">
            <img src="../../img/rebuttalstudio_hori.png" alt="Rebuttal Studio" class="brand-logo" />
          </button>
          <input id="projectSearch" class="search-input" placeholder="Search projects" aria-label="Search projects" />
        </div>
        <div class="topbar-right">
          <button id="newBtn" class="btn">+ New</button>
          <button id="apiOpenBtn" class="btn">API Settings</button>
        </div>
      </header>

      <section class="content">
        <div id="namingPanel" class="panel hidden">
          <h3>Create New Project</h3>
          <div class="create-form-group">
            <label for="projectNameInput">Project Name</label>
            <input id="projectNameInput" class="text-input" placeholder="e.g. My Paper Rebuttal" />
          </div>
          <div class="create-form-group">
            <label for="conferenceSelect">Conference</label>
            <select id="conferenceSelect" class="conference-select">
              <option value="ICLR" selected>ICLR</option>
            </select>
          </div>
          <div class="row">
            <button id="cancelProjectBtn" class="btn">Cancel</button>
            <button id="confirmProjectBtn" class="btn primary">Create Project</button>
          </div>
          <p id="projectNameError" class="error"></p>
        </div>

        <div id="workspace" class="workspace-layout hidden">
          <!-- Left panel: Reviewer Input -->
          <section class="panel workspace-panel">
            <div class="reviewer-tabs-row">
              <div id="reviewerTabs" class="reviewer-tabs">
                <button class="reviewer-tab active" data-reviewer="0">Reviewer 1</button>
              </div>
              <button id="addReviewerBtn" class="add-reviewer-btn" aria-label="Add reviewer">+</button>
            </div>
            <div id="reviewerInput" class="reviewer-input" contenteditable="true"
              data-placeholder="Paste the complete reviewer feedback here. Include all sections: summary, strengths, weaknesses, questions, rating, confidence, and any additional comments from the reviewer.">
            </div>
            <!-- Stage 2 Left Panel Content -->
            <div id="stage2LeftPanel" class="stage2-left-panel hidden"></div>
          </section>

          <!-- Center: Convert button -->
          <div class="convert-column">
            <button id="convertBtn" class="convert-btn" aria-label="Convert reviewer input to structured breakdown"
              title="Convert to structured breakdown">
              <span class="convert-icon">→</span>
              <span class="convert-label">Break down</span>
              <div class="loading-dots"><span></span><span></span><span></span></div>
            </button>
          </div>

          <!-- Right panel: Structured Breakdown (ICLR format) -->
          <section class="panel workspace-panel breakdown-panel">
            <h3 class="breakdown-heading">Structured Breakdown</h3>
            <div id="breakdownContent" class="breakdown-content">
              <!-- Scores row -->
              <div class="scores-header">
                <div class="scores-row">
                  <div class="score-item">
                    <span class="score-label">RATING</span>
                    <span class="score-value" id="scoreRating">A</span>
                  </div>
                  <span class="score-divider">|</span>
                  <div class="score-item">
                    <span class="score-label">CONFIDENCE</span>
                    <span class="score-value" id="scoreConfidence">B</span>
                  </div>
                </div>
                <div class="scores-row">
                  <div class="score-item">
                    <span class="score-label">SOUNDNESS</span>
                    <span class="score-value" id="scoreSoundness">C</span>
                  </div>
                  <span class="score-divider">|</span>
                  <div class="score-item">
                    <span class="score-label">PRESENTATION</span>
                    <span class="score-value" id="scorePresentation">D</span>
                  </div>
                  <span class="score-divider">|</span>
                  <div class="score-item">
                    <span class="score-label">CONTRIBUTION</span>
                    <span class="score-value" id="scoreContribution">E</span>
                  </div>
                </div>
              </div>

              <!-- Block: Summary & Strength -->
              <div class="breakdown-block">
                <div class="breakdown-section">
                  <h4 class="breakdown-section-title">Summary</h4>
                  <div class="breakdown-section-body" id="sectionSummary">
                    <p class="breakdown-placeholder">This is the summary.</p>
                  </div>
                </div>
                <div class="breakdown-section">
                  <h4 class="breakdown-section-title">Strength</h4>
                  <div class="breakdown-section-body" id="sectionStrength">
                    <p class="breakdown-placeholder">This is the strength.</p>
                  </div>
                </div>
              </div>

              <!-- Block: Weakness & Questions -->
              <div class="breakdown-block">
                <div class="breakdown-section">
                  <h4 class="breakdown-section-title">Weakness</h4>
                  <div class="breakdown-section-body" id="sectionWeakness">
                    <p class="breakdown-placeholder">This is the weakness.</p>
                  </div>
                </div>
                <div class="breakdown-section">
                  <h4 class="breakdown-section-title">Questions</h4>
                  <div class="breakdown-section-body" id="sectionQuestions">
                    <p class="breakdown-placeholder">This is the questions.</p>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <div id="emptyState" class="empty-state">
          <div class="home-landing">
            <pre class="ascii-art ascii-red">██████╗ ███████╗██████╗ ██╗   ██╗████████╗████████╗ █████╗ ██╗     
██╔══██╗██╔════╝██╔══██╗██║   ██║╚══██╔══╝╚══██╔══╝██╔══██╗██║     
██████╔╝█████╗  ██████╔╝██║   ██║   ██║      ██║   ███████║██║     
██╔══██╗██╔══╝  ██╔══██╗██║   ██║   ██║      ██║   ██╔══██║██║     
██║  ██║███████╗██████╔╝╚██████╔╝   ██║      ██║   ██║  ██║███████╗
╚═╝  ╚═╝╚══════╝╚═════╝  ╚═════╝    ╚═╝      ╚═╝   ╚═╝  ╚═╝╚══════╝</pre>
            <pre class="ascii-art ascii-blue">███████╗████████╗██╗   ██╗██████╗ ██╗ ██████╗
██╔════╝╚══██╔══╝██║   ██║██╔══██╗██║██╔═══██╗
███████╗   ██║   ██║   ██║██║  ██║██║██║   ██║
╚════██║   ██║   ██║   ██║██║  ██║██║██║   ██║
███████║   ██║   ╚██████╔╝██████╔╝██║╚██████╔╝
╚══════╝   ╚═╝    ╚═════╝ ╚═════╝ ╚═╝ ╚═════╝</pre>
            <div class="creator-box">
              <div class="creator-label">CREATOR</div>
              <div class="creator-name">Run</div>
              <div class="creator-email">run@mail.rit.edu</div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- API Modal -->
  <div id="apiModal" class="modal-backdrop hidden">
    <div class="modal api-modal" role="dialog" aria-modal="true" aria-labelledby="apiModalTitle">
      <h3 id="apiModalTitle">API Settings</h3>

      <div class="settings-group">
        <label for="apiProviderSelect">Provider</label>
        <select id="apiProviderSelect" class="conference-select">
          <option value="openai">OpenAI</option>
          <option value="anthropic">Anthropic</option>
          <option value="gemini">Google Gemini</option>
          <option value="deepseek">DeepSeek</option>
          <option value="azureOpenai">Azure OpenAI</option>
        </select>
      </div>

      <div class="settings-group">
        <label for="apiBaseUrlInput">Base URL</label>
        <input id="apiBaseUrlInput" class="text-input" placeholder="https://api.openai.com/v1" />
        <p id="apiBaseUrlHelp" class="muted"></p>
      </div>

      <div class="settings-group">
        <label for="apiModelInput">Model</label>
        <div class="model-input-row">
          <select id="apiModelSelect" class="conference-select model-select hidden">
            <option value="">-- Select a model --</option>
          </select>
          <input id="apiModelInput" class="text-input" placeholder="gpt-4o-mini" />
          <button id="detectModelsBtn" class="btn" type="button">Detect models</button>
        </div>
        <p id="apiModelHint" class="muted"></p>
      </div>

      <div class="settings-group">
        <label for="apiInput">API Key</label>
        <input id="apiInput" type="password" class="text-input" placeholder="Paste API key" />
      </div>

      <p id="apiSettingsError" class="error"></p>
      <p class="muted">Tip: Google Gemini from AI Studio can use API key only; URL/model can be auto-filled.</p>

      <div class="modal-actions">
        <button id="cancelApiBtn" class="btn">Cancel</button>
        <button id="saveApiBtn" class="btn primary">Save</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal-backdrop hidden">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <h3 id="settingsTitle">Settings</h3>

      <div class="settings-group">
        <label>Theme</label>
        <div class="theme-toggle-row">
          <button id="themeDarkBtn" class="theme-toggle-btn active" data-theme-value="dark">Dark</button>
          <button id="themeLightBtn" class="theme-toggle-btn" data-theme-value="light">Light</button>
        </div>
      </div>

      <div class="settings-group">
        <label for="autosaveInput">Autosave interval (seconds)</label>
        <input id="autosaveInput" class="text-input" type="number" min="10" max="1800" />
        <p class="muted">Minimum 10 s, maximum 1800 s.</p>
      </div>

      <p id="settingsError" class="error"></p>
      <div class="modal-actions">
        <button id="saveNowBtn" class="btn">Save now</button>
        <button id="closeSettingsBtn" class="btn primary">Apply</button>
      </div>
    </div>
  </div>

  <!-- Stage Advance Confirmation Modal -->
  <div id="stageAdvanceModal" class="modal-backdrop hidden">
    <div class="modal stage-advance-modal" role="dialog" aria-modal="true" aria-labelledby="stageAdvanceTitle">
      <h3 id="stageAdvanceTitle">Advance to Next Stage</h3>
      <p id="stageAdvanceMsg" class="stage-advance-msg">Are you sure you want to proceed to the next stage?</p>
      <div class="modal-actions">
        <button id="cancelAdvanceBtn" class="btn">Cancel</button>
        <button id="confirmAdvanceBtn" class="btn primary">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Reviewer Name Modal -->
  <div id="reviewerNameModal" class="modal-backdrop hidden">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="reviewerNameTitle">
      <h3 id="reviewerNameTitle">Reviewer Name</h3>
      <div class="settings-group">
        <label for="reviewerNameInput">Enter the reviewer's 4-character identifier</label>
        <div class="reviewer-name-input-row">
          <span class="reviewer-name-prefix">Reviewer</span>
          <input id="reviewerNameInput" class="text-input reviewer-name-suffix" maxlength="4" placeholder="e.g. Ab1C" />
        </div>
      </div>
      <p id="reviewerNameError" class="error"></p>
      <div class="modal-actions">
        <button id="cancelReviewerNameBtn" class="btn">Cancel</button>
        <button id="confirmReviewerNameBtn" class="btn primary">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Right-click context menu for reviewer tabs -->
  <div id="reviewerContextMenu" class="context-menu hidden">
    <button class="context-menu-item" data-action="rename">✏️ Rename</button>
  </div>

  <!-- Add Response Modal -->
  <div id="addResponseModal" class="modal-backdrop hidden">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="addResponseTitle">
      <h3 id="addResponseTitle">Add Atomic Issue</h3>
      <div class="settings-group">
        <label for="addResponseTypeInput">Type</label>
        <select id="addResponseTypeInput" class="text-input">
          <option value="weakness">Weakness</option>
          <option value="question">Question</option>
        </select>
      </div>
      <div class="settings-group">
        <label for="addResponseTitleInput">Title</label>
        <input id="addResponseTitleInput" class="text-input" placeholder="e.g. Missing baseline comparison" />
      </div>
      <div class="settings-group">
        <label for="addResponseContentInput">Content</label>
        <textarea id="addResponseContentInput" class="text-input" style="min-height: 80px;"
          placeholder="The issue text..."></textarea>
      </div>
      <p id="addResponseError" class="error"></p>
      <div class="modal-actions">
        <button id="cancelAddResponseBtn" class="btn">Cancel</button>
        <button id="confirmAddResponseBtn" class="btn primary">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Stage2 Insert Table Modal -->
  <div id="stage2TableModal" class="modal-backdrop hidden">
    <div class="modal stage2-insert-modal" role="dialog" aria-modal="true" aria-labelledby="stage2TableModalTitle">
      <h3 id="stage2TableModalTitle">Insert Table</h3>
      <div class="settings-group stage2-table-dimensions">
        <div>
          <label for="stage2TableRowsInput">Rows</label>
          <input id="stage2TableRowsInput" type="number" min="1" max="20" class="text-input" value="3" />
        </div>
        <div>
          <label for="stage2TableColsInput">Columns</label>
          <input id="stage2TableColsInput" type="number" min="1" max="10" class="text-input" value="3" />
        </div>
      </div>
      <div class="modal-actions stage2-table-actions">
        <button id="stage2TableBuildBtn" class="btn" type="button">Build Grid</button>
      </div>
      <div id="stage2TableGrid" class="stage2-table-grid"></div>
      <p id="stage2TableError" class="error"></p>
      <div class="modal-actions">
        <button id="stage2TableCancelBtn" class="btn">Cancel</button>
        <button id="stage2TableConfirmBtn" class="btn primary">Insert</button>
      </div>
    </div>
  </div>

  <!-- Stage2 Insert Code Modal -->
  <div id="stage2CodeModal" class="modal-backdrop hidden">
    <div class="modal stage2-insert-modal" role="dialog" aria-modal="true" aria-labelledby="stage2CodeModalTitle">
      <h3 id="stage2CodeModalTitle">Insert Code</h3>
      <div class="settings-group">
        <label for="stage2CodeLanguageInput">Language (optional)</label>
        <input id="stage2CodeLanguageInput" class="text-input" placeholder="e.g. python" />
      </div>
      <div class="settings-group">
        <label for="stage2CodeContentInput">Code</label>
        <textarea id="stage2CodeContentInput" class="text-input stage2-code-input" placeholder="Paste your code here..."></textarea>
      </div>
      <p id="stage2CodeError" class="error"></p>
      <div class="modal-actions">
        <button id="stage2CodeCancelBtn" class="btn">Cancel</button>
        <button id="stage2CodeConfirmBtn" class="btn primary">Insert</button>
      </div>
    </div>
  </div>

  <!-- Template Modal -->
  <div id="templateModal" class="modal-backdrop hidden">
    <div class="modal template-modal" role="dialog" aria-modal="true" aria-labelledby="templateModalTitle">
      <h3 id="templateModalTitle">Template Center</h3>
      <div class="template-layout">
        <section class="template-left">
          <div id="templateAudienceTabs" class="template-audience-tabs"></div>
          <div id="templateTypeList" class="template-type-list"></div>
        </section>
        <section class="template-right">
          <div class="template-preview-header">
            <h4 id="templatePreviewTitle">Template</h4>
            <div class="template-actions">
              <button id="templateRenderCopyBtn" class="btn" title="Render and copy">↗ Render+Copy</button>
              <button id="templateAiPolishBtn" class="btn" title="AI rephrase">✨ Polish</button>
            </div>
          </div>
          <div id="templateFields" class="template-fields"></div>
          <textarea id="templateRenderedOutput" class="text-input template-output" readonly
            placeholder="Rendered template text will appear here..."></textarea>
          <p id="templateError" class="error"></p>
        </section>
      </div>
      <div class="modal-actions">
        <button id="closeTemplateBtn" class="btn primary">Close</button>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>

</html>
